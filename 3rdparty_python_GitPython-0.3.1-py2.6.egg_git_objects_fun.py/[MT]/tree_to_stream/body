def tree_to_stream(entries, write):
    'Write the give list of entries into a stream using its write method\n\t:param entries: **sorted** list of tuples with (binsha, mode, name)\n\t:param write: write method which takes a data string'
    ord_zero = ord('0')
    bit_mask = 7
    for (binsha, mode, name) in entries:
        mode_str = ''
        for i in xrange(6):
            mode_str = (chr((((mode >> (i * 3)) & bit_mask) + ord_zero)) + mode_str)
        if (mode_str[0] == '0'):
            mode_str = mode_str[1:]
        if isinstance(name, unicode):
            name = name.encode('utf8')
        write(('%s %s\x00%s' % (mode_str, name, binsha)))
