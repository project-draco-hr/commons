{
  expectCalls(10,20,30,40,50,60);
  control.replay();
  Rate<Integer> rate=Rate.of(input).withClock(clock).build();
  Rate<Double> rateOfRate=Rate.of(rate).withClock(clock).build();
  assertThat(rate.sample(),is(0d));
  assertThat(rateOfRate.sample(),is(0d));
  clock.waitFor(ONE_SEC);
  assertThat(rate.sample(),is(10d));
  assertThat(rateOfRate.sample(),is(10d));
  clock.waitFor(ONE_SEC);
  assertThat(rate.sample(),is(10d));
  assertThat(rateOfRate.sample(),is(0d));
  clock.waitFor(ONE_SEC);
  assertThat(rate.sample(),is(10d));
  assertThat(rateOfRate.sample(),is(0d));
  clock.waitFor(ONE_SEC);
  assertThat(rate.sample(),is(10d));
  assertThat(rateOfRate.sample(),is(0d));
  clock.waitFor(ONE_SEC);
  assertThat(rate.sample(),is(10d));
  assertThat(rateOfRate.sample(),is(0d));
}
