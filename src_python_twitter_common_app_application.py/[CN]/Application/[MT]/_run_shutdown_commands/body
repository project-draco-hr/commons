def _run_shutdown_commands(self, return_code):
    while ((self._state != self.SHUTDOWN) and self._shutdown_commands):
        command = self._shutdown_commands.pop(0)
        command_thread = ApplicationThread((lambda : command(return_code)))
        command_thread.start()
        while ((self._state != self.SHUTDOWN) and (not command_thread.stopped.is_set())):
            command_thread.stopped.wait(timeout=0.2)
        if command_thread.traceback:
            self._debug_log('shutdown command excepted:')
            self._debug_log('\n'.join(traceback.format_tb(command_thread.traceback)))
    self._state = self.SHUTDOWN
