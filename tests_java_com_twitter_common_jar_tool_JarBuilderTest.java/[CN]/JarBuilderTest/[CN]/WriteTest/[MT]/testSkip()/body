{
  File dir=newFolder("life/of/brian");
  FileUtils.write(new File(dir,"is"),"42");
  FileUtils.write(new File(dir,"used/to/be"),"4");
  File sourceJar=jarBuilder().add(content("1/137"),"meaning/of/the/universe").add(content("fine structure constant"),"meaning/of/the/universe/README").write();
  File destinationJar=jarBuilder().add(content("43"),"meaning/of/life/isn't").addDirectory(dir,Optional.of("meaning/of/life")).addJar(sourceJar).write(true,DuplicateHandler.always(DuplicateAction.THROW),Pattern.compile("is$"),Pattern.compile("/README"));
  doWithJar(destinationJar,new ExceptionalClosure<JarFile,IOException>(){
    @Override public void execute(    JarFile jar) throws IOException {
      assertListing(jar,"meaning/","meaning/of/","meaning/of/life/","meaning/of/life/isn't","meaning/of/life/used/","meaning/of/life/used/to/","meaning/of/life/used/to/be","meaning/of/the/","meaning/of/the/universe");
      assertCompressedContents(jar,"meaning/of/life/isn't","43");
      assertCompressedContents(jar,"meaning/of/life/used/to/be","4");
      assertCompressedContents(jar,"meaning/of/the/universe","1/137");
    }
  }
);
}
