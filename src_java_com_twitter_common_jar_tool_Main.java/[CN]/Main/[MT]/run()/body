{
  if (mainClass.hasAppliedValue() && manifest.hasAppliedValue()) {
    throw new ExitException(1,"Can specify main or manifest but not both.");
  }
  if (target.get().size() != 1) {
    throw new ExitException(1,"Must supply exactly 1 target jar path.");
  }
  final File targetJar=Iterables.getOnlyElement(this.target.get());
  if (!update.get() && targetJar.exists() && !targetJar.delete()) {
    throw new ExitException(1,"Failed to delete file at requested target path %s",targetJar);
  }
  final Closer closer=Closer.create();
  try {
    doRun(closer,targetJar);
  }
  finally {
    try {
      closer.close();
    }
 catch (    IOException e) {
      LOG.warning("Failed to close one or more resources: " + e);
    }
  }
}
