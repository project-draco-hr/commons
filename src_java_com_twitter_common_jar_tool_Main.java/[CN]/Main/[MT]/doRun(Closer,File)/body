{
  JarBuilder jarBuilder=closer.register(new JarBuilder(targetJar,new LoggingListener(targetJar)));
  try {
    @Nullable Manifest mf=getManifest();
    if (mf != null) {
      jarBuilder.useCustomManifest(mf);
    }
  }
 catch (  IOException e) {
    throw new ExitException(1,"Failed to configure custom manifest: %s",e);
  }
  for (  FileSource fileSource : files.get()) {
    fileSource.addTo(jarBuilder);
  }
  for (  File jar : jars.get()) {
    jarBuilder.addJar(jar);
  }
  DuplicateHandler duplicateHandler=new DuplicateHandler(defaultAction.get(),policies.get());
  try {
    jarBuilder.write(compress.get(),duplicateHandler,skip.get());
  }
 catch (  DuplicateEntryException e) {
    throw new ExitException(1,"Refusing to write duplicate entry: %s",e);
  }
catch (  IOException e) {
    throw new ExitException(1,"Unexpected problem writing target jar %s: %s",targetJar,e);
  }
}
