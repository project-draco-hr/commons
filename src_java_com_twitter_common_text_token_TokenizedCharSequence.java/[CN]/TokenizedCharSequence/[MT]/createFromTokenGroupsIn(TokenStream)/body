{
  CharSequenceTermAttribute termAttr=stream.getAttribute(CharSequenceTermAttribute.class);
  TokenGroupAttribute groupAttr=stream.getAttribute(TokenGroupAttribute.class);
  List<TokenizedCharSequence> groups=Lists.newArrayList();
  while (stream.incrementToken()) {
    Builder builder=new Builder(termAttr.getTermCharSequence());
    TokenStream groupStream=groupAttr.getTokenGroupStream();
    CharSequenceTermAttribute groupTermAttr=groupStream.getAttribute(CharSequenceTermAttribute.class);
    TokenTypeAttribute typeAttr=groupStream.getAttribute(TokenTypeAttribute.class);
    while (groupStream.incrementToken()) {
      builder.addToken(groupTermAttr.getOffset() - termAttr.getOffset(),groupTermAttr.getLength(),typeAttr.getType());
    }
    groups.add(builder.build());
  }
  return groups;
}
