def build_pex(args, options):
    interpreter = None
    if options.python:
        if os.path.exists(options.python):
            interpreter = PythonInterpreter.from_binary(options.python)
        else:
            interpreter = PythonInterpreter.from_env(options.python)
        if (interpreter is None):
            die(('Failed to find interpreter: %s' % options.python))
    pex_builder = PEXBuilder(path=safe_mkdtemp(), interpreter=interpreter)
    pex_info = pex_builder.info
    pex_info.zip_safe = options.zip_safe
    pex_info.always_write_cache = options.always_write_cache
    pex_info.ignore_errors = options.ignore_errors
    pex_info.inherit_path = options.inherit_path
    fetchers = [Fetcher(options.repos)]
    if options.pypi:
        fetchers.append(PyPIFetcher())
    resolveds = requirement_resolver(options.requirements, cache=options.cache_dir, fetchers=fetchers, interpreter=interpreter, platform=options.platform)
    if resolveds:
        log('Resolved distributions:', v=options.verbosity)
    for pkg in resolveds:
        log(('  %s' % pkg), v=options.verbosity)
        pex_builder.add_distribution(pkg)
        pex_builder.add_requirement(pkg.as_requirement())
    for source_dir in options.source_dirs:
        dist = Installer(source_dir).distribution()
        if (not dist):
            die(('Failed to run installer for %s' % source_dir), CANNOT_DISTILL)
        egg_path = Distiller(dist).distill()
        if (not egg_path):
            die(('Failed to distill %s into egg' % dist), CANNOT_DISTILL)
        pex_builder.add_egg(egg_path)
    if (options.entry_point is not None):
        log(('Setting entry point to %s' % options.entry_point), v=options.verbosity)
        pex_builder.info.entry_point = options.entry_point
    else:
        log('Creating environment PEX.', v=options.verbosity)
    return pex_builder
