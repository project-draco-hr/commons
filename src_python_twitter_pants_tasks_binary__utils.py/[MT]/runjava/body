def runjava(jvmargs=None, classpath=None, main=None, args=None, only_dump_cmd_line=None):
    'Spawns a java process with the supplied configuration and returns its exit code.'
    cmd = ['java']
    if jvmargs:
        cmd.extend(jvmargs)
    if classpath:
        cmd.extend((('-cp' if main else '-jar'), os.pathsep.join(classpath)))
    if main:
        cmd.append(main)
    if args:
        cmd.extend(args)
    if (only_dump_cmd_line is not None):
        with safe_open(only_dump_cmd_line, 'w') as fd:
            fd.write(' '.join(cmd))
        return 0
    else:
        log.debug(('Executing: %s' % ' '.join(cmd)))
        with safe_classpath():
            return subprocess.call(cmd)
