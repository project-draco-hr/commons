def find_java_home():
    with temporary_dir() as tmpdir:
        with safe_open(os.path.join(tmpdir, 'X.java'), 'w') as srcfile:
            srcfile.write('class X { public static void main(String[] argv) { System.out.println(System.getProperty("java.home")); } }')
        subprocess.Popen(['javac', '-d', tmpdir, srcfile.name], stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate()
        return subprocess.Popen(['java', '-cp', tmpdir, 'X'], stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate()[0]
