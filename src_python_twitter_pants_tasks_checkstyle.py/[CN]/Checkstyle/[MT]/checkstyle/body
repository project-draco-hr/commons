def checkstyle(self, sources):
    classpath = self.profile_classpath(self._profile)
    with self.context.state('classpath', []) as cp:
        classpath.extend((jar for (conf, jar) in cp if (conf in self._confs)))
    opts = ['-c', self._configuration_file, '-f', 'plain']
    if self._properties:
        properties_file = os.path.join(self._work_dir, 'checkstyle.properties')
        with safe_open(properties_file, 'w') as pf:
            for (k, v) in self._properties.items():
                pf.write(('%s=%s\n' % (k, v)))
        opts.extend(['-p', properties_file])
    return self.runjava(CHECKSTYLE_MAIN, classpath=classpath, opts=opts, args=sources, workunit_name='checkstyle')
