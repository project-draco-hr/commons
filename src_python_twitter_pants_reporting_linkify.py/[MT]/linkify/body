def linkify(buildroot, s):
    'Augment text by heuristically finding URL and file references and turning them into links/'

    def to_url(m):
        if m.group(1):
            return m.group(0)
        path = m.group(0)
        if path.startswith('/'):
            path = os.path.relpath(path, buildroot)
        else:
            parts = path.split(':')
            if (len(parts) == 2):
                putative_dir = parts[0]
            else:
                putative_dir = path
            if os.path.isdir(os.path.join(buildroot, putative_dir)):
                path = os.path.join(putative_dir, BuildFile._CANONICAL_NAME)
        if os.path.exists(os.path.join(buildroot, path)):
            return ('/browse/%s' % path)
        else:
            return None

    def maybe_add_link(url, text):
        return (('<a target="_blank" href="%s">%s</a>' % (url, text)) if url else text)
    return _PATH_RE.sub((lambda m: maybe_add_link(to_url(m), m.group(0))), s)
