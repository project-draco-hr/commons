def _sources_hash(self, sha, paths):
    'Update a SHA1 digest with the content of all files under the given paths.\n\n    :returns: The number of files found under the given paths.\n    '
    num_files = 0
    for (relative_filename, filename) in self._walk_paths(paths):
        with open(filename, 'rb') as fd:
            sha.update(Compatibility.to_bytes(relative_filename))
            sha.update(fd.read())
        num_files += 1
    return num_files
