def test_client_iteration():
    with ZookeeperClusterBootstrapper() as port:
        zk = ZooKeeper(('localhost:%d' % port), timeout=10)
        service = ServerSet(zk, SERVICE_PATH)
        client = ServerSetClient(SERVICE_PATH, zk=zk)
        assert (list(client) == [])
        service.register(INSTANCE1)
        assert (list(client) == [INSTANCE1])
        service.register(INSTANCE2)
        assert (list(client) == [INSTANCE1, INSTANCE2])
