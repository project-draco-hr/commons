{
  TestRegistry.consoleRunnerTestRunsFlakyTests=true;
  try {
    ConsoleRunner.main(asArgsArray("FlakyTest -num-retries 2"));
    Assert.fail("Should have failed with RuntimeException due to FlakyTest.methodAlwaysFails");
  }
 catch (  RuntimeException ex) {
  }
 finally {
    TestRegistry.consoleRunnerTestRunsFlakyTests=false;
  }
  Assert.assertEquals("expected_ex flaky1 flaky1 flaky2 flaky2 flaky2 flaky3 flaky3 flaky3 " + "notflaky",TestRegistry.getCalledTests());
  Assert.assertEquals(10,FlakyTest.numFlakyTestInstantiations);
  Assert.assertEquals(1,FlakyTest.numExpectedExceptionMethodInvocations);
}
