def calculate_sources(self, targets):
    bases = set()
    sources = defaultdict(set)

    def collect_sources(target):
        src = (os.path.join(target.target_base, source) for source in target.sources if source.endswith('.scala'))
        if src:
            bases.add(target.target_base)
            sources[target].update(src)
            if (isinstance(target, ScalaLibrary) and target.java_sources):
                base_parent = os.path.dirname(target.target_base)
                sibling_java_base = os.path.join(base_parent, 'java')
                java_src = (os.path.join(sibling_java_base, source) for source in target.java_sources if source.endswith('.java'))
                if java_src:
                    bases.add(sibling_java_base)
                    sources[target].update(java_src)
    for target in targets:
        collect_sources(target)
    return (bases, sources)
