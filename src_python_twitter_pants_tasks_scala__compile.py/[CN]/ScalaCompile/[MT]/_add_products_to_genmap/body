def _add_products_to_genmap(self, artifact, state):
    'Must be called on all targets, whether they needed compilation or not.'
    genmap = self.context.products.get('classes')
    for (target, sources) in artifact.sources_by_target.items():
        for source in sources:
            classes = state.classes_by_src.get(source, [])
            relsrc = os.path.relpath(source, target.target_base)
            genmap.add(relsrc, artifact.classes_dir, classes)
            genmap.add(target, artifact.classes_dir, classes)
        if (is_scalac_plugin(target) and target.classname):
            (basedir, plugin_info_file) = self._zinc_utils.write_plugin_info(self._resources_dir, target)
            genmap.add(target, basedir, [plugin_info_file])
