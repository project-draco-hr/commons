def test_stream():
    stream = Stream(sio(), (GlogLine,))
    lines = read_all(stream, terminator=Stream.EOF)
    assert (len(lines) == 3)
    last_line = lines[(-1)]
    assert last_line.raw.startswith('I1101')
    assert (TEST_GLOG_LINES[(- len(last_line.raw)):] == last_line.raw)
    writer = Compatibility.StringIO()
    stream = Stream(writer, (GlogLine,), infinite=True)
    assert (stream.next() is None)
    write_and_rewind(writer, lines[0].raw)
    assert (stream.next() is None)
    write_and_rewind(writer, '\n')
    assert (stream.next() is None)
    write_and_rewind(writer, lines[1].raw)
    assert (stream.next() == lines[0])
    assert (stream.next() is None)
    write_and_rewind(writer, '\n')
    assert (stream.next() == None)
    write_and_rewind(writer, lines[2].raw)
    assert (stream.next() == lines[1])
