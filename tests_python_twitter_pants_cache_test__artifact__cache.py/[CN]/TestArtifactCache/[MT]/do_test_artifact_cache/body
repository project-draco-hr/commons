def do_test_artifact_cache(self, artifact_cache):
    key = CacheKey('muppet_key', 'fake_hash', 42, [])
    with temporary_file(artifact_cache.artifact_root) as f:
        f.write(TEST_CONTENT1)
        path = f.name
        f.close()
        self.assertFalse(artifact_cache.has(key))
        self.assertFalse(bool(artifact_cache.use_cached_files(key)))
        artifact_cache.insert(key, [path])
        self.assertTrue(artifact_cache.has(key))
        with open(path, 'w') as outfile:
            outfile.write(TEST_CONTENT2)
        self.assertTrue(bool(artifact_cache.use_cached_files(key)))
        with open(path, 'r') as infile:
            content = infile.read()
        self.assertEquals(content, TEST_CONTENT1)
        artifact_cache.delete(key)
        self.assertFalse(artifact_cache.has(key))
