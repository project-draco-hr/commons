def _walk(self, walked, work, predicate=None):
    Target._walk(self, walked, work, predicate)
    for dependency in self.dependencies:
        for dep in dependency.resolve():
            if (isinstance(dep, Target) and (not (dep in walked))):
                walked.add(dep)
                if ((not predicate) or predicate(dep)):
                    additional_targets = work(dep)
                    dep._walk(walked, work, predicate)
                    if additional_targets:
                        for additional_target in additional_targets:
                            additional_target._walk(walked, work, predicate)
