def check_clean_master(self, commit=False):
    if commit:
        if self.restrict_push_branches:
            branch = self.scm.branch_name
            if (branch not in self.restrict_push_branches):
                raise TaskError(('Can only push from %s, currently on branch: %s' % (' '.join(sorted(self.restrict_push_branches)), branch)))
        changed_files = self.scm.changed_files()
        if changed_files:
            raise TaskError(('Can only push from a clean branch, found : %s' % ' '.join(changed_files)))
    else:
        print ('Skipping check for a clean %s in test mode.' % self.scm.branch_name)
