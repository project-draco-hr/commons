{
  Preconditions.checkNotNull(map);
  Preconditions.checkNotNull(filterRule);
  Set<K> prunedKeys=Sets.newHashSet();
  for (  K key : map.keySet()) {
    if (!filterRule.apply(map.get(key))) {
      prunedKeys.add(key);
    }
  }
  Multimap<K,V> pruned=ArrayListMultimap.create();
  for (  K key : prunedKeys) {
    pruned.putAll(key,map.removeAll(key));
  }
  return pruned;
}
