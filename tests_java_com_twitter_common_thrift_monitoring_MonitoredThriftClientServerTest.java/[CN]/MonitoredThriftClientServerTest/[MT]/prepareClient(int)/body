{
  ThriftFactory<Iface> factory=ThriftFactory.create(ThriftService.Iface.class).withMaxConnectionsPerEndpoint(CONNECTIONS_PER_HOST);
  clientMonitor=factory.getMonitor();
  final Thrift<ThriftService.Iface> thrift=factory.build(Sets.newHashSet(new InetSocketAddress(port)));
  addTearDown(new TearDown(){
    @Override public void tearDown(){
      thrift.close();
    }
  }
);
  client=thrift.builder().noRetries().blocking().create();
}
