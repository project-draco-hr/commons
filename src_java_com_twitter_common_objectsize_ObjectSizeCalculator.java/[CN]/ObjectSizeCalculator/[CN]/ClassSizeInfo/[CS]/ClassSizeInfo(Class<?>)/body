{
  long objectSize=0;
  final List<Field> referenceFields=new LinkedList<Field>();
  for (  Field f : clazz.getDeclaredFields()) {
    if (Modifier.isStatic(f.getModifiers())) {
      continue;
    }
    final Class<?> type=f.getType();
    if (type.isPrimitive()) {
      objectSize+=getPrimitiveFieldSize(type);
    }
 else {
      f.setAccessible(true);
      referenceFields.add(f);
      objectSize+=REFERENCE_FIELD_SIZE;
    }
  }
  final Class<?> superClass=clazz.getSuperclass();
  if (superClass != null) {
    final ClassSizeInfo superClassInfo=classSizeInfos.get(superClass);
    objectSize+=superClassInfo.objectSize - OBJECT_HEADER_SIZE;
    referenceFields.addAll(Arrays.asList(superClassInfo.referenceFields));
  }
  this.objectSize=OBJECT_HEADER_SIZE + roundToEight(objectSize);
  this.referenceFields=referenceFields.toArray(new Field[referenceFields.size()]);
}
