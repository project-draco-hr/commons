from __future__ import print_function
import hashlib
import os
import re
import tempfile
from collections import defaultdict, namedtuple
from twitter.common.collections import OrderedSet
from twitter.common.dirutil import safe_mkdir, safe_open
from twitter.pants.base.build_environment import get_buildroot
from twitter.pants.targets import InternalTarget, JavaLibrary, JavaThriftLibrary, ScalaLibrary
from twitter.pants.tasks import TaskError
from twitter.pants.tasks.nailgun_task import NailgunTask
from twitter.pants.thrift_util import calculate_compile_sources, calculate_compile_sources_HACK_FOR_SCROOGE_LEGACY
CompilerConfig = namedtuple('CompilerConfig', ['name', 'config_section', 'profile', 'main', 'calc_srcs', 'langs'])
_COMPILERS = [CompilerConfig(name='scrooge', config_section='scrooge-gen', profile='scrooge-gen', main='com.twitter.scrooge.Main', calc_srcs=calculate_compile_sources, langs=frozenset(['scala', 'java'])), CompilerConfig(name='scrooge-legacy', config_section='scrooge-legacy-gen', profile='scrooge-legacy-gen', main='com.twitter.scrooge.Main', calc_srcs=calculate_compile_sources_HACK_FOR_SCROOGE_LEGACY, langs=frozenset(['scala']))]
_CONFIG_FOR_COMPILER = dict(((compiler.name, compiler) for compiler in _COMPILERS))
_TARGET_TYPE_FOR_LANG = dict(scala=ScalaLibrary, java=JavaLibrary)
NAMESPACE_PARSER = re.compile('^\\s*namespace\\s+([^\\s]+)\\s+([^\\s]+)\\s*$')
TYPE_PARSER = re.compile('^\\s*(const|enum|exception|service|struct|union)\\s+([^\\s{]+).*')
