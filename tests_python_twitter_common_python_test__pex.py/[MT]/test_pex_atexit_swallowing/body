def test_pex_atexit_swallowing():
    body = textwrap.dedent("\n  import atexit\n\n  def raise_on_exit():\n    raise Exception('This is an exception')\n\n  atexit.register(raise_on_exit)\n  ")
    (so, rc) = run_test(body)
    assert (so == '')
    assert (rc == 0)
    env_copy = os.environ.copy()
    env_copy.update(PEX_TEARDOWN_VERBOSE='1')
    (so, rc) = run_test(body, env=env_copy)
    assert ('This is an exception' in so)
    assert (rc == 0)
