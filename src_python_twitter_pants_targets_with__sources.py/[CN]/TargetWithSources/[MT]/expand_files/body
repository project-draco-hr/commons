def expand_files(self, recursive=True):
    'Expand files used to build this target to absolute paths.  By default this expansion is done\n    recursively.'
    files = []

    def _expand(target):
        files.extend([os.path.abspath(os.path.join(target.target_base, s)) for s in (target.sources or [])])
        files.extend([target.address.buildfile.full_path])
        if recursive:
            for dep in target.dependencies:
                if isinstance(dep, TargetWithSources):
                    _expand(dep)
                elif hasattr(dep, 'address'):
                    files.append(dep.address.buildfile.full_path)
    _expand(self)
    return files
