def test_shutdown_commands():
    shutdown = threading.Event()
    shutdown_rc = []

    def shutdown_command(rc):
        shutdown_rc.append(rc)
        shutdown.set()

    def huh_main():
        return 0
    app = TestApplication(huh_main)
    app.register_shutdown_command(shutdown_command)
    app.main()
    shutdown.wait(timeout=1.0)
    assert (shutdown_rc == [0])
    assert shutdown.is_set()
