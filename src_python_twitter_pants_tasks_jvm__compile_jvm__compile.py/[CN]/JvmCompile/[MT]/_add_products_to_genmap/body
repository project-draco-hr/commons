def _add_products_to_genmap(self, targets, sources_by_target, analysis_file):
    classes_by_source = self._compute_classes_by_source(analysis_file)
    genmap = self.context.products.get('classes')
    for target in targets:
        for source in sources_by_target[target]:
            classes = classes_by_source.get(source, [])
            relsrc = os.path.relpath(source, target.target_base)
            genmap.add(relsrc, self._classes_dir, classes)
            genmap.add(target, self._classes_dir, classes)
        for (basedir, prod) in self.extra_products(target):
            genmap.add(target, basedir, prod)
