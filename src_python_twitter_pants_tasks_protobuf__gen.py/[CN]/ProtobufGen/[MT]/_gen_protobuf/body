def _gen_protobuf(self, protobuf_targets, gen):
    (bases, sources) = self._calculate_sources(protobuf_targets)
    args = [self.protobuf_binary, gen]
    for base in bases:
        args.append(('--proto_path=%s' % base))
    args.extend(sources)
    log.debug(('Executing: %s' % ' '.join(args)))
    process = subprocess.Popen(args)
    result = process.wait()
    if (result != 0):
        raise TaskError
