{
  final String text="Hello, this is a test";
  TextTokenizer tokenizer=new DefaultTextTokenizer.Builder().setKeepPunctuation(false).build();
  TokenStream stream=tokenizer.getDefaultTokenStream();
  stream.reset(text);
  TokenStreamSerializer serializer=TokenStreamSerializer.builder().add(new CharSequenceTermAttributeSerializer()).add(new TokenTypeAttributeSerializer()).add(new PositionIncrementAttributeSerializer()).build();
  byte[] data=serializer.serialize(stream);
  TokenStream deserialized=serializer.deserialize(data,text);
  stream.reset(text);
  while (stream.incrementToken()) {
    assertTrue(deserialized.incrementToken());
    assertEquals(stream.toString(),deserialized.toString());
  }
  assertFalse(deserialized.incrementToken());
}
