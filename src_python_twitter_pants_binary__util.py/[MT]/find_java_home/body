def find_java_home():
    with temporary_dir() as tmpdir:
        with open(os.path.join(tmpdir, 'X.java'), 'w') as srcfile:
            srcfile.write('\n        class X {\n          public static void main(String[] argv) {\n            System.out.println(System.getProperty("java.home"));\n          }\n        }')
        subprocess.Popen(['javac', '-d', tmpdir, srcfile.name], stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate()
        return subprocess.Popen(['java', '-cp', tmpdir, 'X'], stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate()[0]
