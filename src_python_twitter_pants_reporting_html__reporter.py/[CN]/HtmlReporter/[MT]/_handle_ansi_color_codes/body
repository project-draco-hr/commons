def _handle_ansi_color_codes(self, s):
    'Replace ansi color sequences with spans of appropriately named css classes.'

    def ansi_code_to_css(code):
        return ' '.join([('ansi-%s' % c) for c in code.split(';')])
    return (('<span>' + HtmlReporter._ANSI_COLOR_CODE_RE.sub((lambda m: ('</span><span class="%s">' % ansi_code_to_css(m.group(1)))), s)) + '</span>')
