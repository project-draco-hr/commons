@contextmanager
def add_products(self, context, product_type, target, *products):
    product_mapping = context.products.get(product_type)
    with temporary_dir() as outdir:

        def create_product(product):
            with safe_open(os.path.join(outdir, product), mode='w') as fp:
                fp.write(product)
            return product
        product_mapping.add(target, outdir, map(create_product, products))
        yield temporary_dir
