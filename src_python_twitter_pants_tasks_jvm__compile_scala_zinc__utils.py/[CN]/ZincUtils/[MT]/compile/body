def compile(self, opts, classpath, sources, output_dir, analysis_file, upstream_analysis_files):
    args = list(opts)
    args.extend(self._plugin_args())
    if upstream_analysis_files:
        args.extend(['-analysis-map', ','.join([('%s:%s' % kv) for kv in upstream_analysis_files.items()])])
    args.extend(['-analysis-cache', analysis_file, '-classpath', ':'.join((self._compiler_classpath + classpath)), '-d', output_dir])
    args.extend(sources)
    self.log_zinc_file(analysis_file)
    if self._run_zinc(args, workunit_labels=[WorkUnit.COMPILER]):
        raise TaskError('Zinc compile failed.')
