def calculate_genfiles(source):
    with open(source, 'r') as thrift:
        lines = thrift.readlines()
        namespaces = {}
        types = defaultdict(set)
        for line in lines:
            match = NAMESPACE_PARSER.match(line)
            if match:
                lang = match.group(1)
                namespace = match.group(2)
                namespaces[lang] = namespace
            else:
                match = TYPE_PARSER.match(line)
                if match:
                    type = match.group(1)
                    name = match.group(2)
                    types[type].add(name)
        genfiles = defaultdict(set)
        namespace = namespaces.get('py')
        if namespace:
            genfiles['py'].update(calculate_python_genfiles(namespace, types))
        namespace = namespaces.get('java')
        if namespace:
            genfiles['java'].update(calculate_java_genfiles(namespace, types))
        return genfiles
