def _copytree(from_base, to_base):

    def abort(error):
        raise TaskError(('Failed to copy from %s to %s: %s' % (from_base, to_base, error)))

    def safe_link(src, dst):
        try:
            os.link(src, dst)
        except OSError as e:
            if (e.errno != errno.EEXIST):
                raise e
    for (dirpath, dirnames, filenames) in os.walk(from_base, topdown=True, onerror=abort):
        to_path = os.path.join(to_base, os.path.relpath(dirpath, from_base))
        for dirname in dirnames:
            safe_mkdir(os.path.join(to_path, dirname))
        for filename in filenames:
            safe_link(os.path.join(dirpath, filename), os.path.join(to_path, filename))
