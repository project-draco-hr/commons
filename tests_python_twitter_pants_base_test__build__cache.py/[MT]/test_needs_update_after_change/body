def test_needs_update_after_change():
    with test_env() as (f, cache):
        key = cache.key_for('test', [f.name])
        assert cache.needs_update(key)
        cache.update(key, [f.name])
        assert (not cache.needs_update(key))
        f.truncate()
        f.write('elmo')
        f.flush()
        key = cache.key_for('test', [f.name])
        assert cache.needs_update(key)
        cache.update(key, [f.name])
        assert (not cache.needs_update(key))
