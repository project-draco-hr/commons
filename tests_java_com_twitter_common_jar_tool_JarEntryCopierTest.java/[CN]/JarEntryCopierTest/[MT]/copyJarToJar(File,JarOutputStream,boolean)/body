{
  Closer closer=Closer.create();
  try {
    JarFile jarIn=JarFileUtil.openJarFile(closer,jarFileIn);
    Enumeration<JarEntry> en=jarIn.entries();
    while (en.hasMoreElements()) {
      JarEntry entry=en.nextElement();
      if (!copyManifest && ("META-INF/".equals(entry.getName()) || "META-INF/MANIFEST.MF".equals(entry.getName()))) {
        continue;
      }
      JarEntryCopier.copyEntry(jos,entry.getName(),jarIn,entry);
    }
  }
  finally {
    closer.close();
  }
}
