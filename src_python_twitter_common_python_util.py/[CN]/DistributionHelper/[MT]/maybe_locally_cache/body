@staticmethod
def maybe_locally_cache(dist, cache_dir):
    from pkg_resources import PathMetadata, Distribution
    from twitter.common.dirutil import safe_rmtree, safe_open, safe_mkdir
    egg_name = os.path.join(cache_dir, (dist.egg_name() + '.egg'))
    safe_mkdir(cache_dir)
    if (not os.path.exists(egg_name)):
        egg_tmp_path = tempfile.mkdtemp(dir=cache_dir, prefix=dist.egg_name())
        for (fn, stream) in DistributionHelper.walk(dist):
            with safe_open(os.path.join(egg_tmp_path, fn), 'wb') as fp:
                shutil.copyfileobj(stream, fp)
        try:
            os.rename(egg_tmp_path, egg_name)
        except OSError as e:
            if (e.errno == errno.ENOTEMPTY):
                safe_rmtree(egg_tmp_path)
    metadata = PathMetadata(egg_name, os.path.join(egg_name, 'EGG-INFO'))
    return Distribution.from_filename(egg_name, metadata=metadata)
