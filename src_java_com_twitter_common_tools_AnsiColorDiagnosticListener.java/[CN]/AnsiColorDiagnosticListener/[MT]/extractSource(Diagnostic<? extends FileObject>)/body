{
  FileObject source=diagnostic.getSource();
  int startPosition=(int)diagnostic.getStartPosition();
  if ((source == null) || (Diagnostic.NOPOS == startPosition) || (startPosition < 1)) {
    return null;
  }
  try {
    CharSequence content=source.getCharContent(true);
    Matcher matcher=EOL.matcher(content);
    int endPosition=(int)diagnostic.getEndPosition();
    if (matcher.find(startPosition)) {
      endPosition=matcher.end();
    }
    if (startPosition == endPosition && startPosition > 0) {
      startPosition--;
    }
    for (; startPosition > 0; startPosition--) {
      if (content.charAt(startPosition) == '\n' || content.charAt(startPosition) == '\r') {
        startPosition++;
        break;
      }
    }
    return content.subSequence(startPosition,endPosition);
  }
 catch (  IOException e) {
    return null;
  }
}
