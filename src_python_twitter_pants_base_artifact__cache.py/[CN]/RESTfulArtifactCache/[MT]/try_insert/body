def try_insert(self, cache_key, build_artifacts):
    path = self._path_for_key(cache_key)
    with temporary_file() as tarfile:
        mode = ('w:bz2' if self.compress else 'w')
        with open_tar(tarfile, mode, dereference=True) as tarout:
            for artifact in build_artifacts:
                tarout.add(artifact, os.path.relpath(artifact, self.artifact_root))
        tarfile.close()
        with open(tarfile.name, 'rb') as infile:
            if (not self._request('PUT', path, body=infile)):
                raise Exception, ('Failed to PUT to %s. Error: 404' % self._url_string(path))
