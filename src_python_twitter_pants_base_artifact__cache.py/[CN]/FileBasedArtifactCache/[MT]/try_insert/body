def try_insert(self, cache_key, build_artifacts):
    cache_dir = self._cache_dir_for_key(cache_key)
    safe_rmtree(cache_dir)
    for artifact in (build_artifacts or ()):
        rel_path = os.path.relpath(artifact, self.artifact_root)
        assert (not rel_path.startswith('..')), ('Artifact %s is not under artifact root %s' % (artifact, self.artifact_root))
        artifact_dest = os.path.join(cache_dir, rel_path)
        dir_name = os.path.dirname(artifact_dest)
        safe_mkdir(dir_name)
        if os.path.isdir(artifact):
            shutil.copytree(artifact, artifact_dest)
        else:
            shutil.copy(artifact, artifact_dest)
