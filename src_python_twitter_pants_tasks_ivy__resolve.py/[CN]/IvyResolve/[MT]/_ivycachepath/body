def _ivycachepath(self, ivyxml, classpathfile, *targets):
    (jars, excludes) = self._calculate_classpath(targets)
    self._generate_ivy(jars, excludes, ivyxml)
    ivy_args = ['-settings', self._ivy_settings, '-cache', self._cachedir, '-ivy', ivyxml, '-cachepath', classpathfile, '-confs']
    ivy_args.extend(self._confs)
    if (not self._transitive):
        ivy_args.append('-notransitive')
    ivy_args.extend(self._args)
    safe_mkdir(os.path.dirname(classpathfile))
    result = self.ng('org.apache.ivy.Main', *ivy_args)
    if (result != 0):
        raise TaskError(('org.apache.ivy.Main returned %d' % result))
