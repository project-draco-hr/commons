def _exec_ivy(self, target_workdir, targets, args):
    ivyxml = os.path.join(target_workdir, 'ivy.xml')
    (jars, excludes) = self._calculate_classpath(targets)
    self._generate_ivy(jars, excludes, ivyxml)
    ivy_opts = ['-settings', self._ivy_settings, '-cache', self._cachedir, '-ivy', ivyxml]
    ivy_opts.extend(args)
    if (not self._transitive):
        ivy_opts.append('-notransitive')
    ivy_opts.extend(self._opts)
    ivy_opts.extend(self._ivy_args)
    result = self.runjava_indivisible('org.apache.ivy.Main', opts=ivy_opts, workunit_name='ivy')
    if (result != 0):
        raise TaskError(('org.apache.ivy.Main returned %d' % result))
