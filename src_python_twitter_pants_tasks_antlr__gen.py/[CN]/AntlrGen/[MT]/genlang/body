def genlang(self, lang, targets):
    if (lang != 'java'):
        raise TaskError(('Unrecognized antlr gen lang: %s' % lang))
    for target in targets:
        java_out = self._java_out(target)
        safe_mkdir(java_out)
        antlr_classpath = self._classpath_by_compiler[target.compiler]
        args = ['-o', java_out]
        if (target.compiler == 'antlr3'):
            java_main = 'org.antlr.Tool'
        elif (target.compiler == 'antlr4'):
            args.append('-visitor')
            java_main = 'org.antlr.v4.Tool'
        else:
            raise TaskError('Unknown ANTLR compiler: {}'.format(target.compiler))
        sources = self._calculate_sources([target])
        args.extend(sources)
        result = self.runjava(classpath=antlr_classpath, main=java_main, args=args, workunit_name='antlr')
        if (result != 0):
            raise TaskError(('java %s ... exited non-zero (%i)' % (java_main, result)))
